<!DOCTYPE html>
<html>
<head>
    <title>Day 98 - Ensemble Methods</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .feature-input { margin-bottom: 10px; }
        .prediction-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .model-card { border-left: 4px solid #667eea; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">üéØ Day 98 - Advanced Ensemble Methods</h1>
                
                {% if not model_loaded %}
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Model not loaded. Please run <code>train_ensemble_model.py</code> first.
                </div>
                {% else %}
                <div class="alert alert-success">
                    ‚úÖ Model loaded: <strong>{{ model_name }}</strong>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <!-- Model Comparison -->
            <div class="col-md-6">
                <div class="card model-card">
                    <div class="card-header">
                        <h5>üìä Model Performance Comparison</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="modelChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>

            <!-- Prediction Interface -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üîÆ Make Prediction</h5>
                    </div>
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="row">
                                {% for feature in feature_names[:6] %}
                                <div class="col-md-6">
                                    <label class="form-label">{{ feature }}</label>
                                    <input type="number" step="0.001" class="form-control feature-input" 
                                           name="{{ feature }}" value="0" required>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="submit" class="btn btn-primary mt-3">Predict</button>
                        </form>

                        <div id="predictionResult" class="mt-3" style="display: none;">
                            <div class="card prediction-card">
                                <div class="card-body">
                                    <h5>Prediction Result</h5>
                                    <p><strong>Diagnosis:</strong> <span id="diagnosis"></span></p>
                                    <p><strong>Probability (Malignant):</strong> <span id="probMalignant"></span></p>
                                    <p><strong>Probability (Benign):</strong> <span id="probBenign"></span></p>
                                    <p><strong>Model Used:</strong> <span id="modelUsed"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ensemble Methods Info -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>üéØ Ensemble Methods Overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <h6>Voting Classifier</h6>
                                <p>Combines predictions from multiple models</p>
                            </div>
                            <div class="col-md-3">
                                <h6>Stacking</h6>
                                <p>Uses meta-learner to combine base models</p>
                            </div>
                            <div class="col-md-3">
                                <h6>Bagging</h6>
                                <p>Parallel training with bootstrap samples</p>
                            </div>
                            <div class="col-md-3">
                                <h6>Boosting</h6>
                                <p>Sequential training focusing on errors</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load model comparison data
        fetch('/model_comparison')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('modelChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Accuracy',
                            data: Object.values(data),
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                                '#9966FF', '#FF9F40'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1.0
                            }
                        }
                    }
                });
            });

        // Handle prediction form
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    document.getElementById('diagnosis').textContent = data.prediction_label;
                    document.getElementById('probMalignant').textContent = data.probability_malignant;
                    document.getElementById('probBenign').textContent = data.probability_benign;
                    document.getElementById('modelUsed').textContent = data.model_used;
                    document.getElementById('predictionResult').style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>